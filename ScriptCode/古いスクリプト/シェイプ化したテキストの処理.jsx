(function (me){	if ( app.preferences.getPrefAsLong("Main Pref Section", "Pref_SCRIPTING_FILE_NETWORK_SECURITY") != 1){		var s = "すみません。以下の設定がオフになっています。\r\n\r\n";		s +=  "「環境設定：一般設定：スクリプトによるファイルへの書き込みとネットワークへのアクセスを許可」\r\n";		s += "\r\n";		s += "このスクリプトを使う為にはオンにする必要が有ります。\r\n";		alert(s);		return;	}	function getFileNameWithoutExt(s)	{		var ret = s;		var idx = ret.lastIndexOf(".");		if ( idx>=0){			ret = ret.substring(0,idx);		}		return ret;	}	function getScriptName()	{		var ary = $.fileName.split("/");		return File.decode( getFileNameWithoutExt(ary[ary.length-1]));	}	function getScriptPath()	{		var s = $.fileName;		return s.substring(0,s.lastIndexOf("/"));	}	var scriptName = getScriptName();	var cameraLayer = null;	var charPosLayer = null;	var targetColLayer = null;	var targetNull = null;		var targetID = 0;	var targetinPoint = 0;	var layerSortInPoint = function(a,b)	{		if (a.inPoint<b.inPoint) return -1;		if (a.inPoint>b.inPoint) return 1;			}//*************************//MainWindowvar winObj = ( me instanceof Panel) ? me : new Window("palette", "アイカツ火炎ら統合", [0,0,0+222,0+214]  ,{resizeable:true, maximizeButton:true, minimizeButton:true});
//*************************//controlsvar lbCaption = winObj.add("statictext",[11, 11, 11+200, 11+12],"アイカツカメラ統合");var lbCaption2 = winObj.add("statictext",[11, 29, 11+200, 29+12],"統合したいレイヤだけ選択");var btnExec = winObj.add("button",[11, 57, 11+160, 57+23],"結合実行");var lbCaption3 = winObj.add("statictext",[11,90, 11+200, 90+12],"ネスト簡易解除、1個ずつ");var btnExec2 = winObj.add("button",[11, 118, 11+160, 118+23],"コピー");var lbCaption4 = winObj.add("statictext",[11,146, 11+200, 146+12],"コピー実行したら元のコンポに戻る");var btnExec3 = winObj.add("button",[11, 174, 11+160, 174+23],"ペースト");btnExec3.enabled = false;//*************************var getLayers = function(){	var ret = [];	var ac = app.project.activeItem;	if (ac instanceof CompItem){		var lyrs = ac.selectedLayers;		if (lyrs<=1) {			alert ("レイヤが2個以上選ばれていない");		}else{			lyrs.sort(layerSortInPoint);			var isCamera = (lyrs[0] instanceof CameraLayer);			for (var i=0; i<lyrs.length;i++)			{				if (lyrs[i].threeDLayer == false){					alert ("コンポが3Dじゃない!");					return ret;				}				if ( (lyrs[i] instanceof CameraLayer)!=isCamera)				{					alert ("カメラとオブジェクトの混在!");					return ret;				}			}			ret = lyrs;		}	}else{		alert ("コンポがアクティブになっていない!");	}	return ret;}//*************************var selectPro= function(lyr,b){	if (lyr instanceof CameraLayer){		lyr.property("ADBE Transform Group").property("ADBE Anchor Point").selected = b;		lyr.property("ADBE Camera Options Group").property("ADBE Camera Zoom").selected = b;	}	lyr.property("ADBE Transform Group").property("ADBE Orientation").selected = b;	lyr.property("ADBE Transform Group").property("ADBE Position").selected = b;
}//*************************var selectionAllOff = function(){	var ac = app.project.activeItem;	if (ac instanceof CompItem){		var s = ac.selectedLayers;		if (s.length>0){			for (var i=0; i<s.length;i++) s[i].selected = false;		}		var s = ac.selectedProperties;		if (s.length>0){			for (var i=0; i<s.length;i++) s[i].selected = false;		}	}}//*************************var execSub = function(lyrs,idx){	var ac = lyrs[0].containingComp;		var lyr = lyrs[idx];	var p = lyr.property("ADBE Transform Group").property("ADBE Position");	if (p.numKeys<=0) return ret;		ac.time =  p.keyTime(1);	selectPro(lyr,true);	app.executeCommand(19); /*copy */	//selectPro(lyr,false);	selectionAllOff();	selectPro(lyrs[0],true);	app.executeCommand(20); /*paste */	//selectPro(lyrs[0],false);	selectionAllOff();	lyr.enabled = false;}//*************************var exec = function(){	var ac = app.project.activeItem;		var sel = getLayers();	if (sel.length<=1) return;	app.beginUndoGroup("生方かすみ-レイヤ統合");	var sels = ac.selectedProperties;	selectionAllOff();	sel[0].outPoint = ac.duration;	for (var i=1; i<sel.length;i++){		execSub(sel,i);	}	app.endUndoGroup();}//*************************var getLayers2 = function(){	var ret = null;	var ac = app.project.activeItem;	if (ac instanceof CompItem){		var sel = ac.selectedLayers;		if (sel.length!=1) {			alert ("レイヤは1個のみ選択してください");		}else{			for ( var i=0; i<sel.length;i++)			{				if (sel[i].source instanceof CompItem)				{					if (sel[i].source.numLayers>0){						ret = sel[i];						break;					}				}			}		}	}else{		alert ("コンポがアクティブになっていない!");	}	return ret;	}//*************************var exec2 = function(){	targetID = 0;	targetInpoint = 0;	btnExec3.enabled = false;		var sel = getLayers2();	if (sel==null) return;		var ac = app.project.activeItem;	if ( !(ac instanceof CompItem)) {		return;	}	var sels = ac.selectedProperties;	selectionAllOff();	var dstCmp = sel.containingComp;	var srcCmp = sel.source;		dstCmp.time = sel.inPoint;	targetInpoint = sel.inPoint;	targerID = 	dstCmp.id;	sel.selected = true;	app.executeCommand(2523); /*レイヤーソースを開く */		for (var i=srcCmp.numLayers; i>=1;i--)	{		srcCmp.layers[i].selected = true;	}	app.executeCommand(19); /*copy */	alert("元のコンポに戻ってペーストボタン！")	btnExec3.enabled = true;}//*************************var exec3 = function(){	var ac = app.project.activeItem;	if ( !(ac instanceof CompItem)) {		alert("コンポが非アクティブ");		return;	}	if (targerID<=0)	{		alert("イリーガルID");		return;	}	if ( targerID != ac.id){		alert("イリーガルIDだだ");		return;	}	app.beginUndoGroup("生方かすみ-ネスト解除");	selectionAllOff();	app.executeCommand(20); /*paste */		var sel = ac.selectedLayers;	if (sel.length>0){		for (var i=0; i<sel.length;i++) {			sel[i].inPoint = targetInpoint;		}	}	targetID = 0;	targetInpoint = 0;	btnExec3.enabled = false;	app.endUndoGroup();}//*************************btnExec.onClick = exec;btnExec2.onClick = exec2;btnExec3.onClick = exec3;//window show	if ( ( me instanceof Panel) == false){
		winObj.center(); 
		winObj.show();
	}})(this);